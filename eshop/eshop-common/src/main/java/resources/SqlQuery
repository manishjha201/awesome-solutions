
CREATE TABLE category (
    id bigint PRIMARY KEY,
    name VARCHAR(255),
    code VARCHAR(64),
    description TEXT,
    status VARCHAR(16),
    catalog_id BIGINT,
    tenant_id BIGINT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by BIGINT,
    last_updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    last_updated_by BIGINT,
    FOREIGN KEY (catalog_id) REFERENCES catalog(id),
    FOREIGN KEY (tenant_id) REFERENCES tenant(id)
    --FOREIGN KEY (created_by) REFERENCES user(id),
    --FOREIGN KEY (last_updated_by) REFERENCES user(id)
);

CREATE TABLE product (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    refID VARCHAR(255),
    title VARCHAR(255),
    name VARCHAR(255),
    description TEXT,
    price DECIMAL(19, 2),
    currency VARCHAR(3),
    category_id BIGINT,
    inventory_id BIGINT,
    status VARCHAR(10) not null default 'ACTIVE',
    image_url VARCHAR(255),
    tenant_id BIGINT,
    is_es_updated BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP,
    created_by BIGINT,
    last_updated_at TIMESTAMP,
    last_updated_by BIGINT,
    version INT,
    CONSTRAINT fk_product_category FOREIGN KEY (category_id) REFERENCES category(id),
    --CONSTRAINT fk_product_created_by FOREIGN KEY (created_by) REFERENCES user(id),
    --CONSTRAINT fk_product_last_updated_by FOREIGN KEY (last_updated_by) REFERENCES user(id),
    --CONSTRAINT fk_product_tenant FOREIGN KEY (tenant_id) REFERENCES tenant(id),
    CONSTRAINT ck_product_status CHECK (status IN ('ACTIVE', 'INACTIVE'))
);

CREATE TABLE inventory (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    in_stock BOOLEAN,
    quantity INT,
    reserved_quantity INT,
    min_stock_quantity INT,
    product_id BIGINT UNIQUE,
    FOREIGN KEY (product_id) REFERENCES product(id)
);

CREATE TABLE cart_product (
    id BIGINT PRIMARY KEY,
    product_id BIGINT NOT NULL,
    quantity INT NOT NULL,
    user_id BIGINT NOT NULL,
    status VARCHAR(64) NOT NULL,
    tenant_id BIGINT,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    created_by VARCHAR(64) NOT NULL,
    last_updated_at TIMESTAMP,
    last_updated_by VARCHAR(64),
    CONSTRAINT fk_product_id FOREIGN KEY (product_id) REFERENCES product(id)
    --CONSTRAINT fk_user_id FOREIGN KEY (user_id) REFERENCES user(id),
    --CONSTRAINT fk_tenant_id FOREIGN KEY (tenant_id) REFERENCES tenant(id)
);

CREATE TABLE cart_payment_request (
    id BIGINT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    cart_product_id BIGINT NOT NULL
    amount NUMERIC(10, 2) NOT NULL,
    payment_status VARCHAR(64) NOT NULL,
    payment_channel VARCHAR(64) NOT NULL,
    created_at DATETIME DEFAULT NOW(),
    created_by VARCHAR(64) NOT NULL,
    last_updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    last_updated_by VARCHAR(64),
    is_active BOOLEAN NOT NULL DEFAULT true,
    tenant_id BIGINT,
    version INT NOT NULL DEFAULT 0,
    CONSTRAINT fk_payment_cart FOREIGN KEY (cart_product_id) REFERENCES cart_product(id)
    --CONSTRAINT fk_payment_user_id FOREIGN KEY (user_id) REFERENCES user(id)
    --CONSTRAINT fk_payment_tenant_id FOREIGN KEY (tenant_id) REFERENCES tenant(id)
);

CREATE TABLE category (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255),
    tenant_id BIGINT,
    created_by BIGINT,
    created_at DATETIME DEFAULT NOW(),
    last_updated_by BIGINT,
    last_updated_at DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE,
    version INT DEFAULT 0,
    FOREIGN KEY (tenant_id) REFERENCES tenant(id),
    FOREIGN KEY (created_by) REFERENCES user(id),
    FOREIGN KEY (last_updated_by) REFERENCES user(id)
) ENGINE=InnoDB;

CREATE TABLE catalog (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255),
    tenant_id BIGINT,
    created_by BIGINT,
    created_at DATETIME DEFAULT NOW(),
    last_updated_by BIGINT,
    last_updated_at DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE,
    version INT DEFAULT 0,
    FOREIGN KEY (tenant_id) REFERENCES tenant(id),
    FOREIGN KEY (created_by) REFERENCES user(id),
    FOREIGN KEY (last_updated_by) REFERENCES user(id)
) ENGINE=InnoDB;

CREATE TABLE product (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255),
    price DECIMAL(10,2),
    catalog_id BIGINT,
    category_id BIGINT,
    tenant_id BIGINT,
    image_url VARCHAR(255),
    created_by BIGINT,
    created_at DATETIME DEFAULT NOW(),
    last_updated_by BIGINT,
    last_updated_at DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE,
    version INT DEFAULT 0,
    FOREIGN KEY (catalog_id) REFERENCES catalog(id),
    FOREIGN KEY (category_id) REFERENCES category(id),
    FOREIGN KEY (tenant_id) REFERENCES tenant(id),
    FOREIGN KEY (created_by) REFERENCES user(id),
    FOREIGN KEY (last_updated_by) REFERENCES user(id)
) ENGINE=InnoDB;


INSERT INTO product (name, price, catalog_id, category_id, tenant_id, image_url, created_by, last_updated_by)
VALUES ('Product 1', 10.99, 1, 1, 1, 'image1.jpg', 6, 7),
       ('Product 2', 20.50, 1, 2, 1, 'image2.jpg', 7, 8),
       ('Product 3', 15.75, 2, 1, 2, 'image3.jpg', 8, 6),
       ('Product 4', 8.99, 2, 2, 2, 'image4.jpg', 7, 8),
       ('Product 5', 12.49, 3, 1, 3, 'image5.jpg', 8, 7);
